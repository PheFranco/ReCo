{% extends 'base.html' %}

{% block title %}Editar Doação — ReCo{% endblock %}

{% block content %}
  <div class="container-fluid mt-4">
  <div class="container d-flex flex-column gap-4">
    <section class="form-card">
      <h1 class="h3 mb-2">Editar Doação</h1>
      <p class="text-muted mb-0">Atualize as informações da sua doação.</p>

      <form method="post" action="{% url 'doacoes:edit_donation' donation.pk %}" enctype="multipart/form-data" class="mt-4">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">{{ form.title.label }}</label>
            {{ form.title }}
            {{ form.title.errors }}
          </div>
          <div class="col-md-6">
            <label class="form-label">{{ form.condition.label }}</label>
            {{ form.condition }}
            {{ form.condition.errors }}
          </div>
          <div class="col-md-6">
            <label class="form-label">{{ form.city.label }}</label>
            {{ form.city }}
            {{ form.city.errors }}
          </div>
          <div class="col-md-6">
            <label class="form-label">{{ form.delivery_type.label }}</label>
            {{ form.delivery_type }}
            {{ form.delivery_type.errors }}
          </div>
          <div class="col-12">
            <label class="form-label">{{ form.description.label }}</label>
            {{ form.description }}
            {{ form.description.errors }}
          </div>
          <div class="col-md-6">
            <label class="form-label">{{ form.contact_email.label }}</label>
            {{ form.contact_email }}
            {{ form.contact_email.errors }}
          </div>
          <div class="col-md-6">
            <label class="form-label">{{ form.contact_phone.label }}</label>
            {{ form.contact_phone }}
            {{ form.contact_phone.errors }}
          </div>
          <div class="col-md-6" id="collection-point-wrap">
            <label class="form-label">{{ form.collection_point.label }}</label>
            {{ form.collection_point }}
            {{ form.collection_point.errors }}
          </div>
          <div class="col-md-6" id="pickup-address-wrap" style="display:none;">
            <label class="form-label">{{ form.pickup_address.label }}</label>
            {{ form.pickup_address }}
            {{ form.pickup_address.errors }}
          </div>
          <div class="col-12">
            <label class="form-label">{{ form.image.label }}</label>
            {% if donation.image %}
              <div class="mb-2">
                <img src="{{ donation.image.url }}" alt="{{ donation.title }}" style="max-width: 200px; border-radius: 8px;">
                <p class="text-muted small">Imagem atual</p>
              </div>
            {% endif %}
            {{ form.image }}
            {{ form.image.errors }}
          </div>
        </div>

        <div class="d-flex gap-2 mt-4">
          <button class="btn btn-primary" type="submit">Salvar Alterações</button>
          <a class="btn btn-outline-secondary" href="{% url 'doacoes:detail' donation.pk %}">Cancelar</a>
        </div>
      </form>
    </section>
  </div>

  <script>
    (function(){
      const typeEl = document.getElementById('delivery-type');
      const collectionWrap = document.getElementById('collection-point-wrap');
      const pickupWrap = document.getElementById('pickup-address-wrap');

      function toggleDeliveryFields() {
        if (typeEl.value === 'domicilio') {
          collectionWrap.style.display = 'none';
          pickupWrap.style.display = 'block';
        } else {
          collectionWrap.style.display = 'block';
          pickupWrap.style.display = 'none';
        }
      }

      if (typeEl) {
        typeEl.addEventListener('change', toggleDeliveryFields);
        toggleDeliveryFields();
      }
    })();
  </script>
  </div>
  </div>
{% endblock %}
