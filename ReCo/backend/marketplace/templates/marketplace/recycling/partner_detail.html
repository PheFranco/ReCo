{% extends 'base.html' %}

{% block title %}{{ partner.company_name }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
<div class="container d-flex flex-column gap-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
    <div>
      <h1 class="h3 mb-1">{{ partner.company_name }}</h1>
      <p class="text-muted mb-0">{{ partner.address }}</p>
    </div>
    <a class="btn btn-outline-secondary" href="{% url 'doacoes:recycling_partner_list' %}">Voltar</a>
  </div>

  <div class="row g-3">
    <div class="col-lg-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column gap-3">
          <div>
            <p class="text-muted mb-1">Contato</p>
            <div>{{ partner.contact_person }}</div>
            <small class="text-muted">{{ partner.phone }} • {{ partner.email }}</small>
          </div>
          <div>
            <p class="text-muted mb-1">Licenças e certificações</p>
            <div>{{ partner.environmental_license|default:"Não informado" }}</div>
            <small class="text-muted">{{ partner.certifications|default:"Sem registros" }}</small>
          </div>
          <div>
            <p class="text-muted mb-1">Capacidade mensal</p>
            <h4 class="mb-0">{{ partner.max_monthly_capacity_kg }} kg</h4>
            <small class="text-muted">Eletrônicos: {{ partner.accepts_electronics|yesno:"Sim,Não" }} • Baterias: {{ partner.accepts_batteries|yesno:"Sim,Não" }}</small>
          </div>
          <div>
            <p class="text-muted mb-1">Status</p>
            {% if partner.is_active %}
              <span class="badge bg-success">Ativo</span>
            {% else %}
              <span class="badge bg-secondary">Inativo</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="mb-3">Lotes enviados</h5>
          <div class="table-responsive">
            <table class="table align-middle">
              <thead><tr><th>Código</th><th>Status</th><th>Peso (kg)</th><th>Itens</th><th>Criado em</th></tr></thead>
              <tbody>
                {% for batch in batches %}
                  <tr>
                    <td>{{ batch.batch_code }}</td>
                    <td><span class="badge bg-secondary">{{ batch.get_status_display }}</span></td>
                    <td>{{ batch.actual_weight_kg|default_if_none:batch.estimated_weight_kg|floatformat:1 }}</td>
                    <td>{{ batch.total_items }}</td>
                    <td>{{ batch.created_at|date:'d/m/Y' }}</td>
                  </tr>
                {% empty %}
                  <tr><td colspan="5" class="text-center text-muted py-4">Nenhum lote registrado.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="mt-3 text-muted small">Total: {{ total_items }} itens • {{ total_weight|floatformat:1 }} kg</div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
{% endblock %}
